---
title: "Powerlifting: An Exploration on the Data"
author: "Zach Eanes & Dalton Rogers"
output: html_document
date: "2024-05-07"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)

ipf <- read_csv("openipf-2024-04-13.csv")
# View(ipf)

ipf <- janitor::clean_names(ipf)
```

# What is "Powerlifting"?
As an easy description, powerlifting is the open sport of competing to see who can lift
the most total weight across three primary lifts. These lifts being Squat, Bench, and Deadlift 
(referred to as SBD throughout this project). 

The general structure of many of these competitions includes many little factors:
1) Everyone is split into weight classes, gender, and age classes. This is to ensure everyone is 
   competing fairly and no one has a clear advantage.
2) Every lifter has 3 attempts for each lifting, leaving 9 total lifts across the competition. 
3) Drug free! No steroids or substances that may boost someone's performance, and these 
   competitors are tested to ensure they are drug free.
4) The concept of good and failed lifts: There's 3 judges for a lift, all viewing a different 
   perspective of the lifter. In order for a lift to be good, 2/3 judges must deem it a good lift.
   Some common failures include not getting enough depth squatting, not controlling the drop after
   a deadlift, or of course literally not getting the weight up.
   
# Linear Progression of Weight Classes?
This one is simple, do heavier weights classes generally lift higher amounts than lower? We can
observe the best successful lift for each SBD and find an average for each weight class group
and then we can compare the classes to see if there's a linear progression.

IPF lists their male weight classes as:
59.0 kg Class:   up to 59.0 kg
66.0 kg Class:   from 59.01 kg up to 66.0 kg
74.0 kg Class:   from 66.01 kg up to 74.0 kg
83.0 kg Class:   from 74.01 kg up to 83.0 kg
93.0 kg Class:   from 83.01 kg up to 93.0 kg
105.0 kg Class:  from 93.01 kg up to 105.0 kg
120.0 kg Class:  from 105.01 kg up to 120.0 kg
120.0+ kg Class: from 120.01 kg up to unlimited

IPF lists their female weifht classes as:
47.0 kg Class up to 47.0 kg
52.0 kg Class from 47.01 kg up to 52.0 kg
57.0 kg Class from 52.01 kg up to 57.0 kg
63.0 kg Class from 57.01 kg up to 63.0 kg
69.0 kg Class from 63.01 kg up to 69.0 kg
76.0 kg Class from 69.01 kg up to 76.0 kg
84.0 kg Class from 76.01 kg up to 84.0 kg
84.0+ kg Class from 84.01 kg up to unlimited
```{r}
# get those in proper weight classes, and make weight_class_kg a factor
male_factors = c(59, 66, 74, 83, 93, 105, 120, "120+")
male_classes <- ipf |> 
    filter(weight_class_kg %in% c(59, 66, 74, 83, 93, 105, 120, "120+") & sex == "M") |>
    mutate(weight_class_kg = factor(weight_class_kg, 
                                       levels = male_factors))

female_factors = c(47, 52, 57, 63, 69, 76, 84, "84+")
female_classes <- ipf |>
    filter(weight_class_kg %in% c(47, 52, 57, 63, 69, 76, 84, "84+") & sex == "F") |>
    mutate(weight_class_kg = factor(weight_class_kg, levels = female_factors))
           
# get average of each best lift in each weight class
avg_weights <- function(class) {
    class |>  # filter out any entry missing the best lift
        filter(!is.na(best3squat_kg)) |> 
        filter(!is.na(best3bench_kg)) |> 
        filter(!is.na(best3deadlift_kg)) |> 
    group_by(weight_class_kg) |> # group by their respective classes
    summarise(avg_squat = sum(best3squat_kg) / n(), # get avg squat
           avg_bench = sum(best3bench_kg) / n(), # get avg bench
           avg_dead = sum(best3deadlift_kg) / n()) |> # get avg deadlift 
    arrange(weight_class_kg) |>
    pivot_longer(cols = c(avg_squat, avg_bench, avg_dead),  # pivot to long format to graph easier
                 names_to = "lift", values_to = "weight")
}

weights_male <- avg_weights(male_classes); weights_male
weights_female <- avg_weights(female_classes); weights_female 

# group by the weight class and put sbd all next to each other in group
weights_male |> ggplot(aes(x = weight_class_kg, y = weight, fill = lift)) + 
    geom_bar(stat = "identity", position = "dodge") +
    labs(
        title = "Comparing Male Average Weights for SBD across Common Weight Classes",
        x = "Weight Class (kg)",
        y = "Average Weight (kg)"
    ) + scale_fill_discrete(name = "What Lift?", labels = c("Squat", "Bench", "Deadlift"))

weights_female |> ggplot(aes(x = weight_class_kg, y = weight, fill = lift)) + 
    geom_bar(stat = "identity", position = "dodge") +
    labs(
        title = "Comparing Female Average Weights for SBD across Common Weight Classes",
        x = "Weight Class (kg)",
        y = "Average Weight (kg)"
    ) + scale_fill_discrete(name = "What Lift?", labels = c("Squat", "Bench", "Deadlift"))
```
In order to get this information together, we had many failures and attempts at using the 
data is a less tidy manner. The biggest change was the inclusion of the pivot_longer in order
to allow us to create more rows and make the graphing easier. It allows us to group and place
each lift inside of the group, as well as creating a cleaner chart in general. Beforehand,
we broke some of the basic policies of tidy data, including storing too much information
inside of a cell and "double dipping". We had numbers in the columns for the lift itself, and
in the end out newest form is tidyest and surely best for our purposes. Below is some of the 
attempts we had beforehand, which ended as a failure in all honesty.

```{r}
# below method is an early attempt that ended in failure 
pre_avg_weights <- function(class) {
    class |>  # filter out any entry missing the best lift
        filter(!is.na(best3squat_kg)) |> 
        filter(!is.na(best3bench_kg)) |> 
        filter(!is.na(best3deadlift_kg)) |> 
    group_by(weight_class_kg) |> # group by their respective classes
    summarise(avg_squat = sum(best3squat_kg) / n(), # get avg squat
           avg_bench = sum(best3bench_kg) / n(), # get avg bench
           avg_dead = sum(best3deadlift_kg) / n()) |> # get avg deadlift 
    arrange(weight_class_kg)
}

# recreate our data set for demonstration purposes
male_classes <- ipf |> 
    filter(weight_class_kg %in% c(59, 66, 74, 83, 93, 105, 120, "120+") & sex == "M") |>
    mutate(weight_class_kg = factor(weight_class_kg, 
                                       levels = male_factors))
# this was the dataset before
pre_avg_weights(male_classes) 

# this was out plot before the pivot_longer, as we just had each lift in thier own graph
pre_avg_weights(male_classes) |> ggplot(aes(x = weight_class_kg, y = avg_squat, fill = avg_squat)) + 
    geom_bar(stat = "identity") 

```

# Percentage of failed lifts across all nine
In this section, we wanted to observe if for certain lifts, competitors are more likely to
fail the lift. In the database, if a life begins with a "-", this means it was a failure. 
Using this, we may be able to get the percentage of good lifts to failed lifts for each lift, 
all 3 for SBD.
```{r}

```

